<!DOCTYPE html>
<meta charset="utf-8">
<style>

@import url(sotm-pdx.css);

.big {
  font-size: 128px;
}

.caption {
  font-size: 96px;
  text-align: center;
  text-shadow: 0px 2px 6px rgba(0,0,0,.5);
}

.caption-small {
  font-size: 76px;
  text-align: center;
  text-shadow: 0px 2px 6px rgba(0,0,0,.5);
}

.caption-smaller {
  font-size: 56px;
  text-align: center;
  text-shadow: 0px 2px 6px rgba(0,0,0,.5);
}

</style>
<body class="overview">

<!-- slide for while people gather :) -->
<section style="background: #222 url(images/mapnik_cape.jpg); background-repeat:no-repeat; background-position:center center;">
</section>

<section>
  <h1 class="caption">New Features in Mapnik >= 2.1</h1>
<!--
<iframe width='100%' height='60%' frameBorder='0' src='http://a.tiles.mapbox.com/v3/examples.map-4l7djmvo.html#13.00/45.5154/-122.6752'></iframe>
-->
  <h1 class="caption-small">Artem Pavlenko & Dane Springmeyer</h1>
  <h1 class="caption-smaller">SOTM US PDX 2012</h1>
</section>

<section>
  <h3>What is Mapnik?</h3>
  <ul>
    <li>Cross platform, high performance, C++ map renderer</li>
    <li>About having fun, making beautiful maps using open data</li>
    <li>tile.osm.org, mapquest.com, maps.stamen.org, mapbox.com, cartodb and hundreds moreâ€¦</li>
  </ul>
</section>

<section>
  <h3>Short history of Mapnik</h3>
  <ul>
    <li>2005-2008: Production tested and evolved with OSM</li>
    <li>2009-2010: First stable releases, community grows</li>
    <li>2011: Major performance push</li>
    <li>2012: Advanced cartography features</li>
  </ul>
</section>

<section>
  <h3>Artem:</h3>
  <p>scale_factor, vertex converters, image-filters, vector output</p>
  <h3>Dane:</h3>
  <p>compositing, svg, new datasources</p>
</section>

<section style="background: #222 url(images/durdle-door.jpg); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Scale factor</h1>
</section>

<section>
  <p>Supported across all backends (AGG, Cairo etc)</p>
</section>

<section>
  <p>Supported across all backends (AGG, Cairo etc)</p>
  <p>Printing, retina display, ???</p>
</section>

<section style="background-image:url(images/map-scale-factor-1.png);
		background-size:100%;background-repeat:no-repeat; background-position:center center; ">
</section>

<section style="background-image:url(images/map-scale-factor-2.png); background-repeat:no-repeat;
		background-size:100%; background-position:center center;">
</section>

<section style="background-image:url(images/map-scale-factor-3.png); background-repeat:no-repeat;
		background-size:100%;background-position:center center;">
</section>

<section style="background-image:url(images/map-scale-factor-4.png); background-repeat:no-repeat; background-position:center center; background-size:100%;">
</section>

<section style="background-image:url(images/map-scale-factor-5.png); background-repeat:no-repeat; background-position:center center;background-size:100%;">
</section>

<section style="background-image:url(images/map-scale-factor-6.png); background-repeat:no-repeat; background-position:center center;background-size:100%;">
</section>

<section style="background: #222 url(images/dunes.jpg); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Vertex converters</h1>
</section>

<section style="background: #222 url(images/dunes.jpg); background-repeat:no-repeat; background-position:center center;">
  <p>Efficient, flexible rendering pipelines with complex transformations</p>
</section>


<section>
  <ul>
    <li>coordinate transforms</li>
    <li>clipping</li>
    <li>smoothing</li>
    <li>offsetting</li>
    <li>simplifying</li>
  </ul>
</section>

<section>
  <p>Simplification algorithms:</p>
  <ul>
    <li>Radial distance</li>
    <li>Visvalingam-Whyatt</li>
    <li>Zhao-Saalfeld</li>
  </ul>
</section>

<section style="background: #222 url(images/map-simplify-0.png); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Original</h1>
</section>

<section style="background: #222 url(images/map-simplify-1.png); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Simplify</h1>
</section>

<section style="background: #222 url(images/map-simplify-2.png); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Simplify a bit more..</h1>
</section>

<section style="background: #222 url(images/map-simplify-smooth.png); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Smooth</h1>
</section>

<section style="background: #222 url(images/map-simplify-smooth-transform.png); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">translate(10 10) <br/>and blur</h1>
</section>

<section style="background: #222 url(images/horses.jpg); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Image filters</h1>
</section>

<section>
<p>Familiar concept - ImageMagick, GIMP, Photoshop</p>
</section>

<section>
<p>Familiar concept - ImageMagick, GIMP, Photoshop</p>
<p>Now can be used directly in Mapnik</p>
</section>

<section>
<p>Familiar concept - ImageMagick, GIMP, Photoshop</p>
<p>Now can be used directly in Mapnik</p>
<p>Chaining</p>
</section>

<section>
  <ul>
    <li>emboss</li>
    <li>blur</li>
    <li>gray</li>
    <li>edge_detect</li>
    <li>sobel</li>
    <li>sharpen</li>
    <li>x/y gradient</li>
    <li>invert</li>
    <li>agg-stack-blur</li>
  </ul>
</section>

<section style="background: #222 url(images/map-blur-dodge.png); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Blur</h1>
</section>

<section style="background: #222 url(images/map-emboss.png); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Emboss</h1>
</section>

<section style="background: #222 url(images/map-emboss-blur-gradient.png); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Emboss + blur + gradient</h1>
</section>

<section style="background: #222 url(images/corfe-castle-2.jpg); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Vector output</h1>
</section>

<section>
<h2>GeoJSON</h2>
<pre>
>>> f.to_geojson()
...
{"type":"Feature","id":1,
"geometry": {"type":"Point",
"coordinates":[-13656028.9,5703798.9]},
"properties":{"name":"Portland",
 "osm_id":1666626393,"place":"city"}}'
</pre>
</section>

<section>
<h2>WKT</h2>
<pre>
>>> f.geometries().to_wkt()
...
Point(-13656028.907842 5703798.985657)
</pre>
</section>

<section>
<h2>WKB</h2>
<pre>
>>> bo = mapnik.wkbByteOrder.XDR
>>> f.geometries().to_wkb(bo)
...
'\x00\x00\x00\x00\x01\xc1j\x0b\xfb\x9d\r\nuAU\xc2\x1d\xbf\x14\xff\x8c'
</pre>
</section>

<section>
<h2>SVG</h2>
<pre>
>>> f.geometries().to_svg()
...
cx="-13656028.907842" cy="5703798.985657"
</pre>
</section>

<section style="background: #222 url(images/sunset.jpg); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Compositing</h1>
</section>

<section>
<h1>Style Level Compositing</h1>
<h3>(whole canvas)</h3>
<pre>
&lt;Style comp-op="color-burn"&gt;
...
&lt;/Style&gt;
</pre>
</section>

<section>
<h1>Style Level Opacity</h1>
<h3>(whole canvas)</h3>
<pre>
&lt;Style opacity=".5"&gt;
...
&lt;/Style&gt;
</pre>
</section>

<section>
<h1>Feature Level</h1>
<h3>(each shape against canvas)</h3>
<pre>
&lt;Style&gt;
&lt;Rule&gt;
&lt;LineSymbolizer comp-op="multiply"/&gt;
&lt;/Rule&gt;
&lt;/Style&gt;
</pre>
</section>


<section style="background: #222 url(images/trees-cabs-crime.png); background-repeat:no-repeat; background-position:center center; background-size:100%;">
</section>


<section style="background: #222 url(images/gclass-without.png); background-repeat:no-repeat; background-position:center center; background-size:100%;">
  <h1 class="caption">No compositing</h1>
</section>


<section style="background: #222 url(images/gclass-with-compositing.png); background-repeat:no-repeat; background-position:center center; background-size:100%;">
  <h1 class="caption">style-level opacity + blur + hard-light/tint-bands</h1>
</section>

<section style="background: #222 url(images/gclass-with-compositing-terrain.png); background-repeat:no-repeat; background-position:center center; background-size:100%;">
  <h1 class="caption">+terrain</h1>
</section>


<section style="background: #222 url(images/difference-paper-smooth.png); background-repeat:no-repeat; background-position:center center; background-size:100%;">
</section>


<section style="background: #222 url(images/windmill.jpg); background-repeat:no-repeat; background-position:center center; background-size:100%;">
  <h1 class="caption">SVG and Marker Advances</h1>
</section>

<section>
<h1>Dynamically transform Markers</h1>
<pre>
marker-transform="scale(2),
  rotate([FIELD]),
  translate(2,2)"
</pre>
<p>^^ CartoCSS</p>
</section>

<section style="background: #222 url(images/marker-data-driven.png); background-repeat:no-repeat; background-position:center center; background-size:100%;">
</section>

<section>
<h1>Dynamically restyle SVG</h1>
<ul>
  <li>opacity, fill-opacity, stroke-opacity</li>
  <li>fill and stroke color</li>
  <li>width/height in px</li>
</ul>
</section>

<section style="background: #222 url(images/octocat-expressions.png); background-repeat:no-repeat; background-position:center center; background-size:100%;">
</section>

<section>
<h3>SVG restyling also works with compositing, image-filters</h3>
</section>

<section style="background: #222 url(images/octo-mask.png); background-repeat:no-repeat; background-position:center center;">
</section>

<section style="background: #222 url(images/tomatoes.jpg); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">New Datasource Plugins</h1>
</section>

<section>
<h1>CSV</h1>
  <ul>
    <li>destroys myth: mapnik needs a database</li>
    <li>extremely fast for small and medium sized data</li>
    <li>supports geodata in x,y fields or WKT/GeoJSON</li>
  </ul>
</section>

<section>
<h1>CSV</h1>
<pre>
>>> import mapnik
>>> csv_string = '''wkt,name
... "POINT(-122.663,45.528)","PDX"'''
>>> ds = mapnik.Datasource(**
... { "type":"csv",
...     "inline":csv_string
... })
</pre>
</section>

<section>
<h1>Python</h1>
  <ul>
    <li>stream your data from anywhere</li>
    <li>mapnik calls into python, iterator returns features</li>
  </ul>
</section>

<section>
<h1>Python</h1>
<pre>
&lt;Datasource&gt;
  &lt;Parameter name="type">
    python
  &lt;/Parameter&gt;
  &lt;Parameter name="factory">
    python_file:python_func
  &lt;/Parameter&gt;
&lt;/Datasource>
</pre>
</section>

<section>
<h1>GeoJSON</h1>
  <ul>
    <li>Ultra optimized - faster than reading via OGR</li>
    <li>Building block code for remote, tiled json datasource</li>
  </ul>
</section>

<section style="background: #222 url(images/bird_watching.jpg); background-repeat:no-repeat; background-position:center center;">
  <h1 class="caption">Looking to the future</h1>
</section>

<section>
<h1>What's next?</h1>
  <ul>
    <li>Direct .osm/.pbf read support</li>
    <li>High performance datasource formats (tiled?)</li>
    <li>Support for every world language</li>
  </ul>
</section>

<section>
  <h1 class="caption">Join us on <br/> github.com/mapnik <br><br> Thank you!</h1>
</section>

<script src="d3.v2.js?2.7.3"></script>
<script src="stack.v0.js"></script>
